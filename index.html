<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agrivoltaic Monitoring Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <!-- The adapter bundle includes date-fns, so the separate script is not needed and was causing an error. -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .kpi-card {
            transition: all 0.3s ease-in-out;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-4 md:mb-0">Agrivoltaic Dashboard</h1>
            <div class="flex items-center space-x-4">
                <label for="site-selector" class="text-gray-400">Select Site:</label>
                <select id="site-selector" class="bg-gray-800 border border-gray-700 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    <option value="stellenbosch">Stellenbosch</option>
                    <option value="malmesbury">Malmesbury</option>
                    <option value="karoo">Karoo</option>
                </select>
            </div>
        </header>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Power Output KPI -->
            <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg">
                <h3 class="text-gray-400 text-sm font-medium">Power Output</h3>
                <p id="kpi-power" class="text-3xl font-semibold text-white mt-2">0 kW</p>
                <p class="text-xs text-green-400 mt-1">Live</p>
            </div>
            <!-- Soil Moisture KPI -->
            <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg">
                <h3 class="text-gray-400 text-sm font-medium">Soil Moisture</h3>
                <p id="kpi-moisture" class="text-3xl font-semibold text-white mt-2">0 %</p>
                <p class="text-xs text-blue-400 mt-1">Optimal</p>
            </div>
            <!-- Panel Temperature KPI -->
            <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg">
                <h3 class="text-gray-400 text-sm font-medium">Panel Temperature</h3>
                <p id="kpi-panel-temp" class="text-3xl font-semibold text-white mt-2">0 °C</p>
                <p class="text-xs text-yellow-400 mt-1">Stable</p>
            </div>
            <!-- Air Temperature KPI -->
            <div class="kpi-card bg-gray-800 p-6 rounded-xl shadow-lg">
                <h3 class="text-gray-400 text-sm font-medium">Air Temperature</h3>
                <p id="kpi-air-temp" class="text-3xl font-semibold text-white mt-2">0 °C</p>
                <p class="text-xs text-gray-400 mt-1">Under Panels</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Energy Production Chart -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h3 class="text-lg font-semibold text-white mb-4">Energy Production</h3>
                <div class="chart-container">
                    <canvas id="energyChart"></canvas>
                </div>
            </div>
            <!-- Agricultural Conditions Chart -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h3 class="text-lg font-semibold text-white mb-4">Agricultural Conditions</h3>
                <div class="chart-container">
                    <canvas id="agriChart"></canvas>
                </div>
=======
<html>
<head>
    <title>My Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        h1 { text-align: center; }
        .dashboard-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* Space between charts */
            justify-content: center;
        }
        .chart-row {
            display: flex;
            width: 100%;
            gap: 20px; /* Space between charts in a row */
            margin-bottom: 20px;
        }
        .chart-container {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        .chart-container-50 { flex-basis: calc(50% - 10px); } /* 50% width minus half gap */
        .chart-container-33 { flex-basis: calc(33.333% - 13.33px); } /* 33% width minus two-thirds gap */

        /* Canvas styling */
        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>My Dashboard</h1>

    <div class="dashboard-container">
        <!-- Row 1 -->
        <div class="chart-row">
            <div class="chart-container chart-container-50">
                <h2>CPU Usage (%)</h2>
                <canvas id="cpuChart"></canvas>
            </div>
            <div class="chart-container chart-container-50">
                <h2>Memory Usage (GB)</h2>
                <canvas id="memoryChart"></canvas>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="chart-row">
            <div class="chart-container chart-container-33">
                <h2>Disk Space</h2>
                <canvas id="diskChart"></canvas>
            </div>
            <div class="chart-container chart-container-33">
                <h2>Network Speed (Mbps)</h2>
                <canvas id="networkChart"></canvas>
            </div>
            <div class="chart-container chart-container-33">
                <h2>Active Users</h2>
                <canvas id="usersChart"></canvas>

            </div>
        </div>
    </div>

    <script>

        // --- MOCK DATA & SIMULATION ---

        // Data structure to hold sensor information for different sites
        const siteData = {
            stellenbosch: {
                name: "Stellenbosch",
                power: { base: 75, fluctuation: 10 },
                moisture: { base: 60, fluctuation: 5 },
                panelTemp: { base: 45, fluctuation: 5 },
                airTemp: { base: 22, fluctuation: 2 },
                irradiance: { base: 800, fluctuation: 100 }
            },
            malmesbury: {
                name: "Malmesbury",
                power: { base: 90, fluctuation: 15 },
                moisture: { base: 45, fluctuation: 7 },
                panelTemp: { base: 55, fluctuation: 8 },
                airTemp: { base: 28, fluctuation: 3 },
                irradiance: { base: 950, fluctuation: 50 }
            },
            karoo: {
                name: "Karoo",
                power: { base: 110, fluctuation: 5 },
                moisture: { base: 25, fluctuation: 5 },
                panelTemp: { base: 60, fluctuation: 5 },
                airTemp: { base: 32, fluctuation: 4 },
                irradiance: { base: 1100, fluctuation: 20 }
            }
        };

        let currentSiteId = 'stellenbosch';
        let energyChart, agriChart;
        let dataUpdateInterval;

        // --- CHART CONFIGURATION ---

        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'second',
                        displayFormats: {
                            second: 'HH:mm:ss'
                        }
                    },
                    ticks: { color: '#9CA3AF' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                y: {
                    beginAtZero: true,
                    ticks: { color: '#9CA3AF' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                }
            },
            plugins: {
                legend: {
                    labels: { color: '#D1D5DB' }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            },
            animation: {
                duration: 500
            }
        };

        // Function to initialize charts
        function initializeCharts() {
            const energyCtx = document.getElementById('energyChart').getContext('2d');
            energyChart = new Chart(energyCtx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Power Output (kW)',
                            data: [],
                            borderColor: '#34D399',
                            backgroundColor: 'rgba(52, 211, 153, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Solar Irradiance (W/m²)',
                            data: [],
                            borderColor: '#FBBF24',
                            backgroundColor: 'rgba(251, 191, 36, 0.1)',
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: { ...commonChartOptions,
                    scales: {
                        x: commonChartOptions.scales.x,
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Power (kW)', color: '#D1D5DB' },
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Irradiance (W/m²)', color: '#D1D5DB' },
                            ticks: { color: '#9CA3AF' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            const agriCtx = document.getElementById('agriChart').getContext('2d');
            agriChart = new Chart(agriCtx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Soil Moisture (%)',
                            data: [],
                            borderColor: '#60A5FA',
                            backgroundColor: 'rgba(96, 165, 250, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Air Temperature (°C)',
                            data: [],
                            borderColor: '#F87171',
                            backgroundColor: 'rgba(248, 113, 113, 0.1)',
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: { ...commonChartOptions,
                    scales: {
                        x: commonChartOptions.scales.x,
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Moisture (%)', color: '#D1D5DB' },
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Temperature (°C)', color: '#D1D5DB' },
                            ticks: { color: '#9CA3AF' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // --- UI & DATA UPDATE LOGIC ---

        // Function to generate a new data point
        function getNewDataPoint(siteId) {
            const site = siteData[siteId];
            const now = new Date();
            return {
                time: now,
                power: (site.power.base + (Math.random() - 0.5) * site.power.fluctuation).toFixed(2),
                moisture: (site.moisture.base + (Math.random() - 0.5) * site.moisture.fluctuation).toFixed(2),
                panelTemp: (site.panelTemp.base + (Math.random() - 0.5) * site.panelTemp.fluctuation).toFixed(2),
                airTemp: (site.airTemp.base + (Math.random() - 0.5) * site.airTemp.fluctuation).toFixed(2),
                irradiance: (site.irradiance.base + (Math.random() - 0.5) * site.irradiance.fluctuation).toFixed(2)
            };
        }

        // Function to update the dashboard with new data
        function updateDashboard() {
            const data = getNewDataPoint(currentSiteId);

            // Update KPI cards
            document.getElementById('kpi-power').textContent = `${data.power} kW`;
            document.getElementById('kpi-moisture').textContent = `${data.moisture} %`;
            document.getElementById('kpi-panel-temp').textContent = `${data.panelTemp} °C`;
            document.getElementById('kpi-air-temp').textContent = `${data.airTemp} °C`;

            // Update charts
            const charts = [energyChart, agriChart];
            charts.forEach(chart => {
                if (chart.data.datasets[0].data.length >= 20) {
                    chart.data.labels.shift();
                    chart.data.datasets.forEach(dataset => dataset.data.shift());
                }
            });

            energyChart.data.labels.push(data.time);
            energyChart.data.datasets[0].data.push(data.power);
            energyChart.data.datasets[1].data.push(data.irradiance);

            agriChart.data.labels.push(data.time);
            agriChart.data.datasets[0].data.push(data.moisture);
            agriChart.data.datasets[1].data.push(data.airTemp);

            energyChart.update('none');
            agriChart.update('none');
        }

        // Function to reset and populate charts for a new site
        function resetAndPopulateData(siteId) {
            // Clear existing data
            energyChart.data.labels = [];
            agriChart.data.labels = [];
            energyChart.data.datasets.forEach(dataset => dataset.data = []);
            agriChart.data.datasets.forEach(dataset => dataset.data = []);

            // Populate with a few initial data points
            for (let i = 0; i < 10; i++) {
                const data = getNewDataPoint(siteId);
                const pastTime = new Date(data.time.getTime() - (10 - i) * 2000);

                energyChart.data.labels.push(pastTime);
                energyChart.data.datasets[0].data.push(data.power);
                energyChart.data.datasets[1].data.push(data.irradiance);

                agriChart.data.labels.push(pastTime);
                agriChart.data.datasets[0].data.push(data.moisture);
                agriChart.data.datasets[1].data.push(data.airTemp);
            }
            energyChart.update();
            agriChart.update();

            // Do one immediate update for KPIs
            updateDashboard();
        }

        // Event listener for the site selector dropdown
        document.getElementById('site-selector').addEventListener('change', (event) => {
            currentSiteId = event.target.value;

            // Stop the current interval
            clearInterval(dataUpdateInterval);

            // Reset charts and start new interval
            resetAndPopulateData(currentSiteId);
            dataUpdateInterval = setInterval(updateDashboard, 2000); // Update every 2 seconds
        });

        // --- INITIALIZATION ---
        window.onload = () => {
            initializeCharts();
            resetAndPopulateData(currentSiteId);
            dataUpdateInterval = setInterval(updateDashboard, 2000);
        };
    </script>

=======
        // Mock data for the charts
        const mockCpuData = {
            labels: ['0s', '10s', '20s', '30s', '40s', '50s', '60s'],
            data: [10, 40, 20, 50, 30, 60, 25]
        };
        const mockMemoryData = {
            labels: ['0s', '10s', '20s', '30s', '40s', '50s', '60s'],
            data: [2.5, 3.0, 2.8, 3.5, 3.2, 3.8, 3.0] // GB
        };
        const mockDiskData = {
            labels: ['Used', 'Free'],
            data: [150, 350] // GB
        };
        const mockNetworkData = { // For Doughnut, as Gauge is not standard
            labels: ['Upload', 'Download'], // Simplified for a doughnut
            data: [50, 250] // Mbps
        };
        const mockUsersData = {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            data: [150, 230, 220, 200, 280, 300, 260]
        };

        // CPU Usage Chart (Line)
        new Chart(document.getElementById('cpuChart'), {
            type: 'line',
            data: {
                labels: mockCpuData.labels,
                datasets: [{
                    label: 'CPU Usage %',
                    data: mockCpuData.data,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, max: 100 } }
            }
        });

        // Memory Usage Chart (Bar)
        new Chart(document.getElementById('memoryChart'), {
            type: 'bar',
            data: {
                labels: mockMemoryData.labels,
                datasets: [{
                    label: 'Memory Usage (GB)',
                    data: mockMemoryData.data,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgb(54, 162, 235)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } }
            }
        });

        // Disk Space Chart (Doughnut)
        new Chart(document.getElementById('diskChart'), {
            type: 'doughnut',
            data: {
                labels: mockDiskData.labels,
                datasets: [{
                    label: 'Disk Space (GB)',
                    data: mockDiskData.data,
                    backgroundColor: ['rgb(255, 99, 132)', 'rgb(54, 162, 235)'],
                    hoverOffset: 4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        // Network Speed Chart (Doughnut - as a stand-in for Gauge)
        // A true gauge would require a custom plugin or a different library
        new Chart(document.getElementById('networkChart'), {
            type: 'doughnut',
            data: {
                labels: mockNetworkData.labels, // Or a single label if representing a single value
                datasets: [{
                    label: 'Network Speed (Mbps)',
                    data: mockNetworkData.data, // Example: [currentSpeed, maxSpeed - currentSpeed] for a semi-circle
                    backgroundColor: ['rgb(255, 205, 86)', 'rgb(201, 203, 207)'],
                    hoverOffset: 4,
                    circumference: 180, // For a semi-circle doughnut
                    rotation: -90       // Start at the bottom
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                if (context.label === 'Upload' || context.label === 'Download') {
                                     return `${context.label}: ${context.raw} Mbps`;
                                }
                                // For a single value gauge, you might want to show only the value
                                // return `${context.raw} Mbps`; 
                                return null;
                            }
                        }
                    }
                }
            }
        });
        // A more accurate gauge might look like this:
        // const networkSpeed = 120; // Current speed
        // const maxNetworkSpeed = 300;
        // new Chart(document.getElementById('networkChart'), {
        //     type: 'doughnut',
        //     data: {
        //         labels: ['Current Speed', 'Remaining'],
        //         datasets: [{
        //             label: 'Network Speed (Mbps)',
        //             data: [networkSpeed, maxNetworkSpeed - networkSpeed],
        //             backgroundColor: ['rgb(255, 159, 64)', 'rgb(230, 230, 230)'],
        //             circumference: 180, // Semi-circle
        //             rotation: 270,      // Start from the left middle
        //             borderWidth: 0,
        //             cutout: '70%'
        //         }]
        //     },
        //     options: {
        //         responsive: true,
        //         maintainAspectRatio: false,
        //         plugins: {
        //             legend: { display: false },
        //             tooltip: { enabled: false },
        //             title: { display: false }
        //         },
        //         animation: { animateRotate: false }
        //     }
        // });


        // Active Users Chart (Polar Area)
        new Chart(document.getElementById('usersChart'), {
            type: 'polarArea',
            data: {
                labels: mockUsersData.labels,
                datasets: [{
                    label: 'Active Users',
                    data: mockUsersData.data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(255, 205, 86, 0.5)',
                        'rgba(201, 203, 207, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(153, 102, 255, 0.5)',
                        'rgba(255, 159, 64, 0.5)'
                    ]
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    </script>

</body>
</html>
